// Generated by Haxe 3.4.0 (git build development @ d3955c6)
(function () { "use strict";
var JsDemo = function() { };
JsDemo.main = function() {
	var tinyCanvasRect = new TinyCanvas(JsDemo.WIDTH,JsDemo.HEIGHT,"canvas-samplerect");
	window.document.body.appendChild(tinyCanvasRect.canvas);
	JsDemo.initTinyCanvas(tinyCanvasRect,JsDemo.X,JsDemo.Y);
	var canvasRectOnClick = function(event) {
		var minDist = 15;
		var drawRadius = minDist * .85;
		var rect_y;
		var rect_x;
		var rect_width;
		var rect_height;
		rect_x = 15;
		rect_y = 15;
		rect_width = tinyCanvasRect.canvas.width - 30;
		rect_height = tinyCanvasRect.canvas.height - 30;
		var samples = JsDemo.generateSamplesInRect(rect_x,rect_y,rect_width,rect_height,minDist);
		JsDemo.clearCanvas(tinyCanvasRect,JsDemo.rectPalette);
		TinyCanvas.drawRect(TinyCanvas.lineStyle(tinyCanvasRect,2.,JsDemo.BOUNDS_COLOR,.75),rect_x,rect_y,rect_width,rect_height);
		JsDemo.drawSamples(tinyCanvasRect,samples,drawRadius,JsDemo.rectPalette);
	};
	tinyCanvasRect.canvas.addEventListener("click",canvasRectOnClick);
	canvasRectOnClick();
	var tinyCanvasCircle = new TinyCanvas(JsDemo.WIDTH,JsDemo.HEIGHT,"canvas-samplecircle");
	window.document.body.appendChild(tinyCanvasCircle.canvas);
	JsDemo.initTinyCanvas(tinyCanvasCircle,JsDemo.X + JsDemo.WIDTH + JsDemo.SPACE,JsDemo.Y);
	var canvasCircleOnClick = function(event1) {
		var minDist1 = 15;
		var radius = tinyCanvasCircle.canvas.width * .45;
		var drawRadius1 = minDist1 * .75;
		var center_y;
		var center_x = tinyCanvasCircle.canvas.width * .5;
		center_y = tinyCanvasCircle.canvas.height * .5;
		var samples1 = JsDemo.generateSamplesInCircle(center_x,center_y,radius,minDist1);
		JsDemo.clearCanvas(tinyCanvasCircle,JsDemo.circlePalette);
		TinyCanvas.drawCircle(TinyCanvas.lineStyle(tinyCanvasCircle,2.,JsDemo.BOUNDS_COLOR,.75),center_x,center_y,radius);
		JsDemo.drawSamples(tinyCanvasCircle,samples1,drawRadius1,JsDemo.circlePalette);
	};
	tinyCanvasCircle.canvas.addEventListener("click",canvasCircleOnClick);
	canvasCircleOnClick();
};
JsDemo.initTinyCanvas = function(tinyCanvas,x,y) {
	var style = tinyCanvas.canvas.style;
	style.backgroundColor = "#000000";
	style.position = "absolute";
	style.left = x == null ? "null" : "" + x;
	style.top = y == null ? "null" : "" + y;
	style.cursor = "hand";
};
JsDemo.generateSamplesInRect = function(x,y,width,height,minDist) {
	var topLeft = new upd_SimplePoint(x,y);
	var bottomRight = new upd_SimplePoint(x + width,y + height);
	var upd1 = new upd_UniformPoissonDisk();
	return upd1.sampleRectangle(topLeft,bottomRight,minDist,JsDemo.OVERRIDE_DEFAULT_POINTS_PER_ITERATION);
};
JsDemo.generateSamplesInCircle = function(cx,cy,radius,minDist) {
	var center = new upd_SimplePoint(cx,cy);
	var upd1 = new upd_UniformPoissonDisk();
	return upd1.sampleCircle(center,radius,minDist,JsDemo.OVERRIDE_DEFAULT_POINTS_PER_ITERATION);
};
JsDemo.generateCustomSamples = function(x,y,width,height,minDist) {
	var topLeft = new upd_SimplePoint(x,y);
	var bottomRight = new upd_SimplePoint(x + width,y + height);
	var upd1 = new upd_UniformPoissonDisk();
	var reject = function(p) {
		if(!(p.x < width * .5 && p.y < height * .5)) {
			if(p.x > width * .5) {
				return p.y > height * .5;
			} else {
				return false;
			}
		} else {
			return true;
		}
	};
	return upd1.sample(topLeft,bottomRight,minDist,reject,JsDemo.OVERRIDE_DEFAULT_POINTS_PER_ITERATION);
};
JsDemo.drawSamples = function(tinyCanvas,samples,radius,palette) {
	var color = palette != null ? palette[0] : 16711680;
	var fillAlpha = .8;
	var _g = 0;
	while(_g < samples.length) {
		var p = samples[_g];
		++_g;
		color = JsDemo.getRandomColorFrom(palette,color);
		TinyCanvas.lineStyle(tinyCanvas,1.5,color,1);
		TinyCanvas.beginFill(tinyCanvas,color,fillAlpha);
		TinyCanvas.drawCircle(tinyCanvas,p.x,p.y,.25);
		TinyCanvas.drawCircle(tinyCanvas,p.x,p.y,radius);
		TinyCanvas.endFill(tinyCanvas);
	}
};
JsDemo.clearCanvas = function(tinyCanvas,palette) {
	var color = palette != null ? palette[0] : 16711680;
	TinyCanvas.drawRect(TinyCanvas.lineStyle(TinyCanvas.clear(tinyCanvas),3,color,1),0,0,tinyCanvas.canvas.width,tinyCanvas.canvas.height);
};
JsDemo.getRandomColorFrom = function(palette,defaultColor) {
	if(palette == null || palette.length == 0) {
		return defaultColor;
	} else {
		return palette[Std.random(palette.length)];
	}
};
var Std = function() { };
Std.random = function(x) {
	if(x <= 0) {
		return 0;
	} else {
		return Math.floor(Math.random() * x);
	}
};
var TinyCanvas = function(width,height,id,useThisCanvas) {
	if(useThisCanvas == null) {
		this.canvas = window.document.createElement("canvas");
	} else {
		this.canvas = useThisCanvas;
	}
	this.canvas.width = width;
	this.canvas.height = height;
	this.canvas.id = id;
	this.context = this.canvas.getContext("2d",null);
};
TinyCanvas.intToRgb = function(color) {
	return { r : color >> 16 & 255, g : color >> 8 & 255, b : color & 255};
};
TinyCanvas.clear = function(tinyCanvas) {
	var ctx = tinyCanvas.context;
	ctx.clearRect(0,0,tinyCanvas.canvas.width,tinyCanvas.canvas.height);
	return tinyCanvas;
};
TinyCanvas.lineStyle = function(tinyCanvas,thickness,color,alpha) {
	if(alpha == null) {
		alpha = 1.;
	}
	var ctx = tinyCanvas.context;
	ctx.lineWidth = thickness;
	var rgb = TinyCanvas.intToRgb(color);
	if(alpha != 1.0) {
		ctx.strokeStyle = "rgba(" + rgb.r + ", " + rgb.g + ", " + rgb.b + ", " + alpha + ")";
	} else {
		ctx.strokeStyle = "rgb(" + rgb.r + ", " + rgb.g + ", " + rgb.b + ")";
	}
	return tinyCanvas;
};
TinyCanvas.beginFill = function(tinyCanvas,color,alpha) {
	if(alpha == null) {
		alpha = 1.;
	}
	var ctx = tinyCanvas.context;
	var rgb = TinyCanvas.intToRgb(color);
	if(alpha != 1.0) {
		ctx.fillStyle = "rgba(" + rgb.r + ", " + rgb.g + ", " + rgb.b + ", " + alpha + ")";
	} else {
		ctx.fillStyle = "rgb(" + rgb.r + ", " + rgb.g + ", " + rgb.b + ")";
	}
	return tinyCanvas;
};
TinyCanvas.endFill = function(tinyCanvas) {
	var ctx = tinyCanvas.context;
	ctx.fill();
	return tinyCanvas;
};
TinyCanvas.moveTo = function(tinyCanvas,x,y) {
	var ctx = tinyCanvas.context;
	ctx.beginPath();
	ctx.moveTo(x,y);
	return tinyCanvas;
};
TinyCanvas.lineTo = function(tinyCanvas,x,y) {
	var ctx = tinyCanvas.context;
	ctx.lineTo(x,y);
	return tinyCanvas;
};
TinyCanvas.quadTo = function(tinyCanvas,cx,cy,ax,ay) {
	var ctx = tinyCanvas.context;
	ctx.quadraticCurveTo(cx,cy,ax,ay);
	return tinyCanvas;
};
TinyCanvas.stroke = function(tinyCanvas,closePath) {
	if(closePath == null) {
		closePath = true;
	}
	var ctx = tinyCanvas.context;
	ctx.stroke();
	if(closePath) {
		ctx.closePath();
	}
	return tinyCanvas;
};
TinyCanvas.drawCircle = function(tinyCanvas,x,y,radius) {
	var ctx = tinyCanvas.context;
	ctx.beginPath();
	ctx.arc(x,y,radius,0,2 * Math.PI,false);
	ctx.stroke();
	ctx.closePath();
	return tinyCanvas;
};
TinyCanvas.drawRect = function(tinyCanvas,x,y,width,height) {
	var ctx = tinyCanvas.context;
	ctx.beginPath();
	ctx.moveTo(x,y);
	ctx.lineTo(x + width,y);
	ctx.lineTo(x + width,y + height);
	ctx.lineTo(x,y + height);
	ctx.lineTo(x,y);
	ctx.stroke();
	ctx.closePath();
	return tinyCanvas;
};
TinyCanvas.main = function() {
	var tinyCanvas = new TinyCanvas(300,300,"canvas");
	window.document.body.appendChild(tinyCanvas.canvas);
	TinyCanvas.lineStyle(tinyCanvas,0,0,0);
	TinyCanvas.beginFill(tinyCanvas,65280);
	TinyCanvas.drawCircle(tinyCanvas,40,40,40);
	TinyCanvas.endFill(tinyCanvas);
	TinyCanvas.drawRect(TinyCanvas.lineStyle(TinyCanvas.endFill(TinyCanvas.drawRect(TinyCanvas.beginFill(tinyCanvas,16776960),0,0,40,40)),2.,16711680,1),0,0,40,40);
	var tinyCanvas1 = TinyCanvas.lineStyle(tinyCanvas,5,16777215,.5);
	var ctx = tinyCanvas1.context;
	ctx.beginPath();
	ctx.moveTo(0,0);
	var tinyCanvas2 = tinyCanvas1;
	var ctx1 = tinyCanvas2.context;
	ctx1.lineTo(50,50);
	var tinyCanvas3 = TinyCanvas.stroke(tinyCanvas2);
	var ctx2 = tinyCanvas3.context;
	ctx2.beginPath();
	ctx2.moveTo(100,100);
	var tinyCanvas4 = tinyCanvas3;
	var ctx3 = tinyCanvas4.context;
	ctx3.lineTo(30,70);
	var tinyCanvas5 = tinyCanvas4;
	var ctx4 = tinyCanvas5.context;
	ctx4.lineTo(80,20);
	var tinyCanvas6 = tinyCanvas5;
	var ctx5 = tinyCanvas6.context;
	ctx5.lineTo(60,60);
	TinyCanvas.quadTo(tinyCanvas6,80,60,80,80);
	TinyCanvas.stroke(tinyCanvas);
	TinyCanvas.endFill(tinyCanvas);
};
TinyCanvas.prototype = {
	get_width: function() {
		return this.canvas.width;
	}
	,get_height: function() {
		return this.canvas.height;
	}
	,get_id: function() {
		return this.canvas.id;
	}
};
var upd_SimplePoint = function(x,y) {
	this.x = x;
	this.y = y;
};
var upd_UniformPoissonDisk = function() {
	this.pointsPerIteration = upd_UniformPoissonDisk.DEFAULT_POINTS_PER_ITERATION;
};
upd_UniformPoissonDisk.prototype = {
	sampleCircle: function(center,radius,minDistance,pointsPerIteration) {
		var _gthis = this;
		var topLeft = new upd_SimplePoint(center.x - radius,center.y - radius);
		var bottomRight = new upd_SimplePoint(center.x + radius,center.y + radius);
		var radiusSquared = radius * radius;
		var reject = function(p) {
			var dx = center.x - p.x;
			var dy = center.y - p.y;
			return dx * dx + dy * dy > radiusSquared;
		};
		return this.sample(topLeft,bottomRight,minDistance,reject,pointsPerIteration);
	}
	,sampleRectangle: function(topLeft,bottomRight,minDistance,pointsPerIteration) {
		return this.sample(topLeft,bottomRight,minDistance,null,pointsPerIteration);
	}
	,init: function(topLeft,bottomRight,minDistance,reject,pointsPerIteration) {
		if(pointsPerIteration == null) {
			this.pointsPerIteration = upd_UniformPoissonDisk.DEFAULT_POINTS_PER_ITERATION;
		}
		this.topLeft = topLeft;
		this.bottomRight = bottomRight;
		this.minDistance = minDistance;
		this.reject = reject;
		this.width = bottomRight.x - topLeft.x;
		this.height = bottomRight.y - topLeft.y;
		this.cellSize = minDistance / upd_Tools.SQUARE_ROOT_TWO;
		this.gridWidth = (this.width / this.cellSize | 0) + 1;
		this.gridHeight = (this.height / this.cellSize | 0) + 1;
		this.grid = [];
		var _g1 = 0;
		var _g = this.gridHeight;
		while(_g1 < _g) {
			var y = _g1++;
			var tmp = this.grid;
			var _g2 = [];
			var _g4 = 0;
			var _g3 = this.gridWidth;
			while(_g4 < _g3) {
				var x = _g4++;
				_g2.push(null);
			}
			tmp.push(_g2);
		}
		this.activePoints = [];
		this.sampledPoints = [];
	}
	,sample: function(topLeft,bottomRight,minDistance,reject,pointsPerIteration) {
		this.init(topLeft,bottomRight,minDistance,reject,pointsPerIteration);
		this.addFirstPoint();
		while(this.activePoints.length != 0) {
			var randomIndex = Std.random(this.activePoints.length);
			var point = this.activePoints[randomIndex];
			var found = false;
			var _g1 = 0;
			var _g = this.pointsPerIteration;
			while(_g1 < _g) {
				var k = _g1++;
				found = this.addNextPoint(point);
				if(found) {
					break;
				}
			}
			if(!found) {
				this.activePoints.splice(randomIndex,1);
			}
		}
		return this.sampledPoints;
	}
	,addFirstPoint: function() {
		var added = false;
		var tries = upd_UniformPoissonDisk.DEFAULT_FIRST_POINT_TRIES;
		while(!added && tries > 0) {
			--tries;
			var rndX = this.topLeft.x + this.width * Math.random();
			var rndY = this.topLeft.y + this.height * Math.random();
			var p = new upd_SimplePoint(rndX,rndY);
			if(this.reject != null && this.reject(p)) {
				continue;
			}
			added = true;
			var index_y;
			var index_x;
			var topLeft = this.topLeft;
			var cellSize = this.cellSize;
			index_x = (p.x - topLeft.x) / cellSize | 0;
			index_y = (p.y - topLeft.y) / cellSize | 0;
			this.activePoints.push(p);
			this.sampledPoints.push(p);
			this.grid[index_y | 0][index_x | 0] = p;
		}
	}
	,addNextPoint: function(point) {
		var q = this.randomPointAround(point,this.minDistance);
		var mustReject = this.reject != null && this.reject(q);
		if(q.x >= this.topLeft.x && q.x < this.bottomRight.x && q.y >= this.topLeft.y && q.y < this.bottomRight.y && !mustReject) {
			var topLeft = this.topLeft;
			var cellSize = this.cellSize;
			var qIndex = new upd_SimplePoint((q.x - topLeft.x) / cellSize | 0,(q.y - topLeft.y) / cellSize | 0);
			if(!this.isInNeighbourhood(q,qIndex)) {
				this.activePoints.push(q);
				this.sampledPoints.push(q);
				this.grid[qIndex.y | 0][qIndex.x | 0] = q;
				return true;
			}
		}
		return false;
	}
	,isInRectangle: function(point) {
		if(point.x >= this.topLeft.x && point.x < this.bottomRight.x && point.y >= this.topLeft.y) {
			return point.y < this.bottomRight.y;
		} else {
			return false;
		}
	}
	,isInNeighbourhood: function(point,index) {
		var i = Math.max(0,index.x - 2) | 0;
		while(i < Math.min(this.gridWidth,index.x + 3)) {
			var j = Math.max(0,index.y - 2) | 0;
			while(j < Math.min(this.gridHeight,index.y + 3)) {
				var tmp;
				if(this.grid[j][i] != null) {
					var p = this.grid[j][i];
					var dx = p.x - point.x;
					var dy = p.y - point.y;
					tmp = Math.sqrt(dx * dx + dy * dy) < this.minDistance;
				} else {
					tmp = false;
				}
				if(tmp) {
					return true;
				}
				++j;
			}
			++i;
		}
		return false;
	}
	,addSampledPoint: function(point,index) {
		this.activePoints.push(point);
		this.sampledPoints.push(point);
		this.grid[index.y | 0][index.x | 0] = point;
	}
	,randomPointAround: function(center,minDistance) {
		var d = Math.random();
		var radius = minDistance + minDistance * d;
		d = Math.random();
		var angle = upd_Tools.TWO_PI * d;
		var x = radius * Math.sin(angle);
		var y = radius * Math.cos(angle);
		return new upd_SimplePoint(center.x + x,center.y + y);
	}
	,pointToGridCoords: function(point,topLeft,cellSize) {
		return new upd_SimplePoint((point.x - topLeft.x) / cellSize | 0,(point.y - topLeft.y) / cellSize | 0);
	}
	,distanceSquared: function(p,q) {
		var dx = p.x - q.x;
		var dy = p.y - q.y;
		return dx * dx + dy * dy;
	}
	,distance: function(p,q) {
		var dx = p.x - q.x;
		var dy = p.y - q.y;
		return Math.sqrt(dx * dx + dy * dy);
	}
};
var upd_Tools = function() { };
upd_Tools.randomInt = function(upperBound) {
	return Std.random(upperBound);
};
upd_Tools.randomFloat = function(upperBound) {
	if(upperBound == null) {
		upperBound = 1.0;
	}
	return Math.random() * upperBound;
};
JsDemo.X = 15;
JsDemo.Y = 15;
JsDemo.SPACE = 15;
JsDemo.WIDTH = 200;
JsDemo.HEIGHT = 200;
JsDemo.BOUNDS_COLOR = 12632256;
JsDemo.RED_PALETTE = [16711680,16064512,14685461,16723984];
JsDemo.GREEN_PALETTE = [65280,62752,1433621,1113904];
JsDemo.FIRE_PALETTE = [16601145,16610051,16620879,16638337,16598019,16601145,16610051,16620879];
JsDemo.GRASS_PALETTE = [11137665,12249985,8181122,4116355,55684,5894785,12245889,8189314];
JsDemo.rectPalette = JsDemo.FIRE_PALETTE;
JsDemo.circlePalette = JsDemo.GRASS_PALETTE;
upd_UniformPoissonDisk.DEFAULT_POINTS_PER_ITERATION = 30;
upd_UniformPoissonDisk.DEFAULT_FIRST_POINT_TRIES = 1000;
upd_Tools.PI = Math.PI;
upd_Tools.HALF_PI = Math.PI / 2;
upd_Tools.TWO_PI = Math.PI * 2;
upd_Tools.SQUARE_ROOT_TWO = Math.sqrt(2);
JsDemo.main();
})();
